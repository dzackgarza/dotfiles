#!/bin/bash
# Test JACK audio session control via Cadence

set -e

echo "1. Killing pulseaudio (will respawn)..."
killall -9 pulseaudio 2>/dev/null || true
sleep 2

echo "2. Stopping JACK..."
jack_control stop || echo "JACK was not running"
sleep 1

echo "3. Force restarting (stopping all audio processes)..."
killall -9 a2j a2jmidid artsd jackd jackdmp knotify4 lash ladishd ladiappd ladiconfd jmcore jackdbus 2>/dev/null || true
sleep 2

echo "3. Verifying stopped..."
if jack_control status > /dev/null 2>&1; then
    echo "ERROR: JACK still running"
    exit 1
fi
echo "✓ JACK stopped"
sleep 1

echo "4. Starting JACK..."
jack_control start
sleep 2

echo "5. Verifying running..."
if jack_control status > /dev/null 2>&1; then
    echo "✓ JACK started successfully"
    jack_control status
else
    echo "ERROR: JACK failed to start"
    exit 1
fi

echo "Done"
